{"version":3,"file":"876-77126e73786779a4a8a9.js","mappings":"8GAKIA,E,2DAEJ,IA0LMC,GAAQ,OAAO,QAAP,sBAAH,2EAMX,UAhMuB,WACrB,OAAwBC,EAAAA,EAAAA,YAAjBC,EAAP,KAAaC,EAAb,KACA,GAA4BF,EAAAA,EAAAA,UAAS,IAA9BG,EAAP,KAAeC,EAAf,KACMC,EAAW,EACf,kBAAQC,MAAM,OAAOC,IAAK,GAA1B,SAIF,GAAkCP,EAAAA,EAAAA,UAA2B,SAAtDQ,EAAP,KAAkBC,EAAlB,KAGA,GAA4CT,EAAAA,EAAAA,UAAwBK,GAA7DK,EAAP,KAAuBC,EAAvB,KAGA,GAAgDX,EAAAA,EAAAA,UAAS,IAAlDY,EAAP,KAAyBC,EAAzB,KACMC,GAAWC,EAAAA,EAAAA,QAAyB,OAE1CC,EAAAA,EAAAA,YAAU,WACHf,IACLA,EAAKgB,GAAG,OAAQb,GAChBH,EAAKgB,GAAG,QAAQ,SAAAC,GACdA,EAAKC,OAAOrB,EAAa,CAAEsB,WAAY,cAExC,CAACnB,KAqBJe,EAAAA,EAAAA,YAAU,WACRK,UAAUC,aACPC,mBACAC,MAAK,SAAAC,GACJ,IAAMC,EAAiC,GACjCC,EAAkC,GAClCC,EAAiC,GAEvCH,EAAQI,SAAQ,SAACC,EAAQC,GACvB,IAAQC,EAAoBF,EAApBE,MAAOC,EAAaH,EAAbG,SACTC,GACJ,kBAAQ5B,MAAO2B,EAAU1B,IAAKwB,GAC3BC,GAIL,OAAQF,EAAOK,MACb,IAAK,aACHT,EAAgBU,KAAKF,GACrB,MAEF,IAAK,cACHP,EAAiBS,KAAKF,GACtB,MAEF,IAAK,aACHN,EAAgBQ,KAAKF,OAO3BvB,EAAkBiB,MAEnBS,MAAMC,QAAQC,SAChB,KA4BHvB,EAAAA,EAAAA,YAAU,WACR,IAAmCwB,EAwBnCnB,UAAUC,aACPmB,cAzBgCD,EAyBP5B,EAvBnB,KADC4B,EAEG,CACLE,OAAO,EACPC,OAAO,GAIF,CAILD,OAAO,EACPC,MAAO,CACLV,SAAUO,EACVI,UAAW,GACXC,OAAQ,IACRC,MAAO,SAQdtB,MAAK,SAAAuB,GACJjD,EAAciD,EACTjC,EAASkC,UACdlC,EAASkC,QAAQC,UAAYF,MAE9BV,MAAMC,QAAQC,SAChB,CAAC3B,IAMJ,OACE,yBACE,oBACE,QAACb,EAAD,CAAOmD,UAAQ,EAACC,OAAK,EAACC,aAAW,EAACC,IAAKvC,MAczC,oBACE,sCACA,kBAAQwC,SAhEV,SAAAC,IApBwB,SAC1BA,EACAC,GAEA,IAAMC,EAASF,EAAGE,OACZ1B,EAAQ0B,EAAOC,cAErBF,EADcC,EAAOE,QAAQ5B,GAAOzB,OAepCsD,CAAoBL,EAAI1C,KAgEjBH,KAGL,oBACE,kCACA,iBACEmD,QA9B4D,SAAAN,GAClElC,UAAUyC,UAAUC,UAAaC,SAASC,KAA1C,gBAA8D9D,IA8BxD+D,UAAU,EACVC,KAAK,OACL7D,MAAOH,MAGX,oBACE,kBAAQ0D,QA3JsD,WAClE,OAAQrD,GACN,IAAK,QAEDN,EADED,EACM,IAAImE,IAAJ,CAASjE,EAAQkE,EAAAA,GAEjB,IAAID,IAAJ,CAASC,EAAAA,IAEnB5D,EAAa,QACb,MAEF,IAAK,OACH,IAAKR,EAAM,OACXA,EAAKqE,UACL7D,EAAa,YA6IsBD","sources":["webpack://ugonf/./src/components/loadable/receive.tsx"],"sourcesContent":["import styled from \"@emotion/styled\"\nimport React, { useEffect, useRef, useState } from \"react\"\nimport Peer from \"skyway-js\"\nimport { peerOptions } from \"../../utils/skyway\"\n\nlet localStream: MediaStream\n\nconst App: React.VFC = () => {\n  const [peer, setPeer] = useState<Peer>()\n  const [peerId, setPeerId] = useState(\"\")\n  const listInit = [\n    <option value=\"null\" key={0}>\n      null\n    </option>,\n  ]\n  const [indicator, setIndicator] = useState<\"Start\" | \"Stop\">(\"Start\")\n  // const [audioInputList, setAudioInputList] = useState<JSX.Element[]>(listInit);\n  // const [audioOutputList, setAudioOutputList] = useState<JSX.Element[]>(listInit);\n  const [videoInputList, setVideoInputList] = useState<JSX.Element[]>(listInit)\n  // const [audioInputDevice, setAudioInputDevice] = useState(\"\");\n  // const [audioOutputDevice, setAudioOutputDevice] = useState(\"\");\n  const [videoInputDevice, setVideoInputDevice] = useState(\"\")\n  const videoRef = useRef<HTMLVideoElement>(null)\n\n  useEffect(() => {\n    if (!peer) return\n    peer.on(\"open\", setPeerId)\n    peer.on(\"call\", conn => {\n      conn.answer(localStream, { videoCodec: \"VP9\" })\n    })\n  }, [peer])\n\n  const clickBtnHandler: React.MouseEventHandler<HTMLButtonElement> = () => {\n    switch (indicator) {\n      case \"Start\":\n        if (peer) {\n          setPeer(new Peer(peerId, peerOptions))\n        } else {\n          setPeer(new Peer(peerOptions))\n        }\n        setIndicator(\"Stop\")\n        break\n\n      case \"Stop\":\n        if (!peer) return\n        peer.destroy()\n        setIndicator(\"Start\")\n        break\n    }\n  }\n\n  useEffect(() => {\n    navigator.mediaDevices\n      .enumerateDevices()\n      .then(devices => {\n        const $audioInputList: JSX.Element[] = []\n        const $audioOutputList: JSX.Element[] = []\n        const $videoInputList: JSX.Element[] = []\n\n        devices.forEach((device, index) => {\n          const { label, deviceId } = device\n          const option = (\n            <option value={deviceId} key={index}>\n              {label}\n            </option>\n          )\n\n          switch (device.kind) {\n            case \"audioinput\":\n              $audioInputList.push(option)\n              break\n\n            case \"audiooutput\":\n              $audioOutputList.push(option)\n              break\n\n            case \"videoinput\":\n              $videoInputList.push(option)\n              break\n          }\n        })\n\n        // setAudioInputList($audioInputList)\n        // setAudioOutputList($audioOutputList)\n        setVideoInputList($videoInputList)\n      })\n      .catch(console.error)\n  }, [])\n\n  const changeSelectHandler = (\n    ev: React.ChangeEvent<HTMLSelectElement>,\n    setState: React.Dispatch<React.SetStateAction<string>>\n  ) => {\n    const target = ev.target\n    const index = target.selectedIndex\n    const value = target.options[index].value\n    setState(value)\n  }\n\n  // const changeAudioInputDeviceHandler: React.ChangeEventHandler<HTMLSelectElement> = (ev) => {\n  //   changeSelectHandler(ev, setAudioInputDevice)\n  // }\n\n  // const changeAudioOutputDeviceHandler: React.ChangeEventHandler<HTMLSelectElement> = (ev) => {\n  //   changeSelectHandler(ev, setAudioOutputDevice)\n  // }\n\n  const changeVideoInputDeviceHandler: React.ChangeEventHandler<\n    HTMLSelectElement\n  > = ev => {\n    changeSelectHandler(ev, setVideoInputDevice)\n  }\n\n  type DeviceIdCheck = (str: string) => MediaStreamConstraints\n\n  useEffect(() => {\n    const constraints: DeviceIdCheck = str => {\n      switch (str) {\n        case \"\":\n          return {\n            audio: false,\n            video: false,\n          }\n\n        default:\n          return {\n            // audio: {\n            //   deviceId: audioInputDevice,\n            // },\n            audio: false,\n            video: {\n              deviceId: str,\n              frameRate: 30,\n              height: 720,\n              width: 1280,\n            },\n          }\n      }\n    }\n\n    navigator.mediaDevices\n      .getUserMedia(constraints(videoInputDevice))\n      .then(stream => {\n        localStream = stream\n        if (!videoRef.current) return\n        videoRef.current.srcObject = stream\n      })\n      .catch(console.error)\n  }, [videoInputDevice])\n\n  const clickTextHandler: React.MouseEventHandler<HTMLInputElement> = ev => {\n    navigator.clipboard.writeText(`${location.href}send/?peerId=${peerId}`)\n  }\n\n  return (\n    <>\n      <div>\n        <Video autoPlay muted playsInline ref={videoRef} />\n      </div>\n      {/* <div>\n        <span>Audio Input (dev): </span>\n        <select onChange={changeAudioInputDeviceHandler}>\n          {audioInputList}\n        </select>\n      </div>\n      <div>\n        <span>Audio Output (dev): </span>\n        <select onChange={changeAudioOutputDeviceHandler}>\n          {audioOutputList}\n        </select>\n      </div> */}\n      <div>\n        <span>Video Input: </span>\n        <select onChange={changeVideoInputDeviceHandler}>\n          {videoInputList}\n        </select>\n      </div>\n      <div>\n        <span>Peer ID: </span>\n        <input\n          onClick={clickTextHandler}\n          readOnly={true}\n          type=\"text\"\n          value={peerId}\n        />\n      </div>\n      <div>\n        <button onClick={clickBtnHandler}>{indicator}</button>\n      </div>\n    </>\n  )\n}\n\nconst Video = styled(\"video\")`\n  background-color: #000;\n  width: 1280px;\n  height: 720px;\n`\n\nexport default App\n"],"names":["localStream","Video","useState","peer","setPeer","peerId","setPeerId","listInit","value","key","indicator","setIndicator","videoInputList","setVideoInputList","videoInputDevice","setVideoInputDevice","videoRef","useRef","useEffect","on","conn","answer","videoCodec","navigator","mediaDevices","enumerateDevices","then","devices","$audioInputList","$audioOutputList","$videoInputList","forEach","device","index","label","deviceId","option","kind","push","catch","console","error","str","getUserMedia","audio","video","frameRate","height","width","stream","current","srcObject","autoPlay","muted","playsInline","ref","onChange","ev","setState","target","selectedIndex","options","changeSelectHandler","onClick","clipboard","writeText","location","href","readOnly","type","Peer","peerOptions","destroy"],"sourceRoot":""}